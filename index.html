<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="custom.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">Groups</a>
      <form class="form-inline ml-auto">
        <input id="input-n" class="form-control mr-sm-2 bg-dark" placeholder="How many groups?">
        <button id="button-n" class="btn btn-outline-light my-2 my-sm-0">Roll</button>
      </form>
    </nav>
    <div class='container'>
      <div id='results' class='row'></div>
    </div>

<script src='https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.3.10/seedrandom.min.js'></script>
<script>
const users = [
  "alex.bui",
  "alexis.theyssier",
  "amel.braiek",
  "aurelio.lima.ferreira",
  "benoit.rameau",
  "bogdan.ceu",
  "capucine.leclerc",
  "carlos.facchin",
  "charles.chiacchia",
  "charlotte.guerin",
  "christian.lim",
  "christopher.fremond",
  "constance.henrot",
  "daniel.deutsch",
  "edouard.de.laage",
  "francesca.ringot",
  "frederic.olive",
  "frederic.paquet",
  "gaelle.fougre",
  "guillaume.nobis",
  "helena.domlan",
  "helene.blanchard",
  "joffrey.chauleau",
  "kim.spychalski",
  "leila.rhazaoui",
  "lorraine.chastang",
  "louise.foussat",
  "ludivine.pellissier",
  "marie.malarme",
  "mehdi.chtira",
  "mikael.verdu",
  "hedi.kochad",
  "mohand.hassam",
  "nadia.djellali",
  "pany.soukaloun",
  "philippe.maguer",
  "pierre.langevin",
  "pierre.poretti",
  "quentin.roiseux",
  "romain.reslinger",
  "sabrina.berguer",
  "samy.kacemi",
  "samuel.sarano",
  "samuel.lambert",
  "sichelle.chiffert",
  "smain.khaldi",
  "sophie.michaudel",
  "souhail.souid",
  "valery.chin",
  "yann.coulleau",
  "yvan.latorre",
]

const getUrlParams = (url, separator = '?') => {
  const hashes = url.slice(url.indexOf(separator) + 1).split('&')
  const params = {}
  hashes.map(hash => {
    const [key, val] = hash.split('=')
    params[key] = decodeURIComponent(val)
  })

  return params
}

const shuffle = (array, shouldShuffleInPlace = false) => {
  let n = array.length
  let i, tmp

  if (!shouldShuffleInPlace) {
    array = [ ...array ]
  }
  while (n) {
    i = Math.floor(Math.random() * n--)

    tmp = array[i]
    array[i] = array[n]
    array[n] = tmp
  }

  return array
}

const splitArrayInChunks = (array, chunkSize) => {
  const chunks = []

  for (i = 0; i < array.length; i += chunkSize) {
    chunks.push(array.slice(i, i + chunkSize))
  }

  return chunks
}

const splitArrayInBalancedChunks = (array, n) => {
  const sizes = []
  const chunks = []

  const each = Math.floor(array.length / n)
  const rest = array.length % n

  for (let i = 0; i < n; i++) {
    sizes.push(each + (i < rest ? 1 : 0))
  }
  let i = 0
  for (size of sizes) {
    chunks.push(array.slice(i, i + size))
    i += size
  }

  return chunks
}

const newSeed = () => Math.floor(Math.random() * 10000)

const { search: qs, hash } = window.location
const params = getUrlParams(qs)
const n = Number(params.n) || 9
const seed = Number(params.s) || newSeed()

Math.seedrandom(seed)

const search = `?n=${n}&s=${seed}`
if (window.location.search !== search) {
  window.location.search = search
}

const groups = splitArrayInBalancedChunks(shuffle(users), n)
const groupSizes = groups.map(g => g.length)

const results = groups.map((group, i) => {
  const title = `<h6>> group${i + 1} (${group.length})</h6>`
  const list = `
    <ul class="list-group">
      ${group.map(user => `<li class="list-group-item p-1 pl-2">${user}</li>`).join('')}
    </ul>
  `
  return `<div class='col-lg-4 col-md-4 col-sm-6 col-12 pt-3'>${title}${list}</div>`
}).join('')

const $ = id => document.getElementById(id)

const resultsDiv = $('results')
resultsDiv.innerHTML = results

const button = $('button-n')
const input = $('input-n')
button.addEventListener('click', e => {
  e.preventDefault()

  const n = Number(input.value) || 9
  const seed = newSeed()
  const search = `?n=${n}&s=${seed}`

  window.location.search = search
})

</script>
  </body>
</html>